{{define "content"}}
<div class="page-header">
    <h1>Quick Scan</h1>
</div>

{{if .Error}}
<div class="alert alert-error">{{.Error}}</div>
{{end}}

<div class="card">
    <div class="card-body">
        <p>Run a one-time scan without creating a scheduled job.</p>

        <form method="POST" action="/scans/quick">
            {{csrfField .CSRFToken}}
            <div class="form-group form-group-narrow">
                <label class="form-label">Paths to Scan <button type="button" class="help-icon" onclick="togglePathsHelp(this, {{if .AllowedPaths}}true{{else}}false{{end}})">?</button></label>
                <div class="list-input" id="paths-container">
                    <div class="list-items" id="paths-list">
                        {{range .Paths}}
                        <div class="list-item">
                            <input type="hidden" name="paths" value="{{.}}">
                            <span class="list-item-text">{{.}}</span>
                            <button type="button" class="list-item-remove" aria-label="Remove" onclick="removeListItem(this)">&times;</button>
                        </div>
                        {{end}}
                    </div>
                    <div class="list-add">
                        <input type="text" id="new-path" class="form-input"
                               placeholder="/path/to/directory" data-path-autocomplete
                               autocorrect="off" autocapitalize="off" spellcheck="false">
                        <button type="button" class="btn" onclick="addPath()">Add</button>
                    </div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label" for="min_size">Minimum Size <button type="button" class="help-icon" onclick="toggleSizeHelp(this)">?</button></label>
                    <input type="text" id="min_size" name="min_size" class="form-input"
                           value="{{.MinSize}}" placeholder="1 MB"
                           autocorrect="off" autocapitalize="off">
                </div>

                <div class="form-group">
                    <label class="form-label" for="max_size">Maximum Size <button type="button" class="help-icon" onclick="toggleSizeHelp(this)">?</button></label>
                    <input type="text" id="max_size" name="max_size" class="form-input"
                           value="{{.MaxSize}}" placeholder="10 GB"
                           autocorrect="off" autocapitalize="off">
                </div>
            </div>

            <div class="form-row-wide">
                <div class="form-group">
                    <label class="form-label">Include Patterns <button type="button" class="help-icon" onclick="toggleGlobHelp(this)">?</button></label>
                    <div class="list-input" id="include-container">
                        <div class="list-items" id="include-list">
                            {{range .IncludePatterns}}
                            <div class="list-item">
                                <input type="hidden" name="include_patterns" value="{{.}}">
                                <span class="list-item-text">{{.}}</span>
                                <button type="button" class="list-item-remove" aria-label="Remove" onclick="removeListItem(this)">&times;</button>
                            </div>
                            {{end}}
                        </div>
                        <div class="list-add">
                            <input type="text" id="new-include" class="form-input" placeholder="**.jpg"
                                   autocorrect="off" autocapitalize="off" spellcheck="false">
                            <button type="button" class="btn" onclick="addPattern('include')">Add</button>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Exclude Patterns <button type="button" class="help-icon" onclick="toggleGlobHelp(this)">?</button></label>
                    <div class="list-input" id="exclude-container">
                        <div class="list-items" id="exclude-list">
                            {{range .ExcludePatterns}}
                            <div class="list-item">
                                <input type="hidden" name="exclude_patterns" value="{{.}}">
                                <span class="list-item-text">{{.}}</span>
                                <button type="button" class="list-item-remove" aria-label="Remove" onclick="removeListItem(this)">&times;</button>
                            </div>
                            {{end}}
                        </div>
                        <div class="list-add">
                            <input type="text" id="new-exclude" class="form-input" placeholder="**.xmp"
                                   autocorrect="off" autocapitalize="off" spellcheck="false">
                            <button type="button" class="btn" onclick="addPattern('exclude')">Add</button>
                        </div>
                    </div>
                </div>
            </div>

            <details class="advanced-section">
                <summary class="advanced-toggle">Advanced Options</summary>
                <div class="advanced-content">
                    <div class="form-row">
                        <div class="form-group">
                            <div class="advanced-option">
                                <label class="form-checkbox">
                                    <input type="checkbox" name="include_hidden" value="1"
                                           {{if .IncludeHidden}}checked{{end}}>
                                    <span>Include hidden files</span>
                                </label>
                                <button type="button" class="help-icon" onclick="toggleAdvancedHelp(this, 'hidden')">?</button>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="advanced-option">
                                <label class="form-checkbox">
                                    <input type="checkbox" name="follow_links" value="1"
                                           {{if .FollowLinks}}checked{{end}}>
                                    <span>Follow symbolic links</span>
                                </label>
                                <button type="button" class="help-icon" onclick="toggleAdvancedHelp(this, 'symlinks')">?</button>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <div class="advanced-option">
                                <label class="form-checkbox">
                                    <input type="checkbox" name="one_file_system" value="1"
                                           {{if .OneFileSystem}}checked{{end}}>
                                    <span>Same filesystem only</span>
                                </label>
                                <button type="button" class="help-icon" onclick="toggleAdvancedHelp(this, 'filesystem')">?</button>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="advanced-option">
                                <label class="form-checkbox">
                                    <input type="checkbox" name="no_ignore" value="1"
                                           {{if .NoIgnore}}checked{{end}}>
                                    <span>Ignore .gitignore</span>
                                </label>
                                <button type="button" class="help-icon" onclick="toggleAdvancedHelp(this, 'gitignore')">?</button>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <div class="advanced-option">
                                <label class="form-checkbox">
                                    <input type="checkbox" name="ignore_case" value="1"
                                           {{if .IgnoreCase}}checked{{end}}>
                                    <span>Case-insensitive patterns</span>
                                </label>
                                <button type="button" class="help-icon" onclick="toggleAdvancedHelp(this, 'case')">?</button>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="advanced-option">
                                <span class="advanced-option-label">Max Depth</span>
                                <button type="button" class="help-icon" onclick="toggleAdvancedHelp(this, 'depth')">?</button>
                                <input type="number" id="max_depth" name="max_depth" class="form-input-compact"
                                       value="{{.MaxDepth}}" placeholder="Unlimited" min="0">
                            </div>
                        </div>
                    </div>
                </div>
            </details>

            <div class="actions-bar">
                <button type="submit" class="btn btn-primary">Run Scan</button>
                <a href="/" class="btn">Cancel</a>
            </div>
        </form>
    </div>
</div>

<div class="card">
    <div class="card-header">Need to run scans regularly?</div>
    <div class="card-body">
        <p>Create a scheduled job to automate your duplicate detection.</p>
        <a href="/jobs/new" class="btn">New Scheduled Job</a>
    </div>
</div>

{{end}}
