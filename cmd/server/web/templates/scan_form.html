{{define "content"}}
<div class="page-header">
    <h1>{{if .Config}}Edit{{else}}New{{end}} Scan Configuration</h1>
</div>

<div class="card">
    <div class="card-body">
        <form method="POST" action="{{if .Config}}/scans/{{.Config.ID}}{{else}}/scans{{end}}">
            <div class="form-group">
                <label class="form-label" for="name">Name</label>
                <input type="text" id="name" name="name" class="form-input"
                       value="{{if .Config}}{{.Config.Name}}{{end}}" required
                       placeholder="e.g., Media Library Scan">
            </div>

            <div class="form-group">
                <label class="form-label">Paths to Scan</label>
                <div id="paths-list">
                {{range .Paths}}
                <div class="form-checkbox">
                    <input type="checkbox" name="paths" value="{{.ID}}"
                           id="path-{{.ID}}"
                           {{if $.Config}}{{if containsPath $.Config.Paths .ID}}checked{{end}}{{end}}>
                    <label for="path-{{.ID}}">
                        {{.Path}}
                        {{if .FromEnv}}<span class="locked">(from env)</span>{{end}}
                    </label>
                </div>
                {{end}}
                {{if not .Paths}}
                <p class="form-help" id="no-paths-msg">No paths configured yet.</p>
                {{end}}
                </div>
                <div class="add-path-form">
                    <input type="text" id="new-path" name="new_path" class="form-input"
                           placeholder="/path/to/directory" style="flex: 1;">
                    <button type="button" class="btn"
                            hx-post="/settings/paths/add-inline"
                            hx-include="closest .form-group"
                            hx-target="#paths-list"
                            hx-swap="innerHTML">Add Path</button>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label" for="min_size">Min Size</label>
                    <input type="text" id="min_size" name="min_size" class="form-input"
                           value="{{if .Config}}{{if .Config.MinSize}}{{.Config.MinSize | formatBytes}}{{end}}{{end}}"
                           placeholder="e.g., 1 MB">
                </div>

                <div class="form-group">
                    <label class="form-label" for="max_size">Max Size</label>
                    <input type="text" id="max_size" name="max_size" class="form-input"
                           value="{{if .Config}}{{if .Config.MaxSize}}{{.Config.MaxSize | formatBytes}}{{end}}{{end}}"
                           placeholder="e.g., 10 GB">
                </div>

                <div class="form-group form-group-wide">
                    <label class="form-label" for="include_patterns">Include Patterns</label>
                    <input type="text" id="include_patterns" name="include_patterns" class="form-input"
                           value="{{if .Config}}{{.Config.IncludePatterns | joinPatterns}}{{end}}"
                           placeholder="e.g., *.mp4, *.mkv">
                </div>

                <div class="form-group form-group-wide">
                    <label class="form-label" for="exclude_patterns">Exclude Patterns</label>
                    <input type="text" id="exclude_patterns" name="exclude_patterns" class="form-input"
                           value="{{if .Config}}{{.Config.ExcludePatterns | joinPatterns}}{{end}}"
                           placeholder="e.g., *.nfo, Thumbs.db">
                </div>
            </div>

            <div class="actions-bar">
                <button type="submit" class="btn btn-primary">
                    {{if .Config}}Save Changes{{else}}Create Configuration{{end}}
                </button>
                <a href="/scans" class="btn">Cancel</a>
                {{if .Config}}
                <button type="button" class="btn btn-danger"
                        hx-delete="/scans/{{.Config.ID}}"
                        hx-confirm="Are you sure you want to delete this configuration?">
                    Delete
                </button>
                {{end}}
            </div>
        </form>
    </div>
</div>
{{end}}
