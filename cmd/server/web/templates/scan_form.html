{{define "content"}}
<div class="page-header">
    <h1>{{if .Config}}Edit{{else}}New{{end}} Scan Configuration</h1>
</div>

<div class="card">
    <div class="card-body">
        <form method="POST" action="{{if .Config}}/scans/{{.Config.ID}}{{else}}/scans{{end}}">
            <div class="form-group">
                <label class="form-label" for="name">Name</label>
                <input type="text" id="name" name="name" class="form-input"
                       value="{{if .Config}}{{.Config.Name}}{{end}}" required
                       placeholder="e.g., Media Library Scan">
            </div>

            <div class="form-group">
                <label class="form-label">Paths to Scan</label>
                {{range .Paths}}
                <div class="form-checkbox">
                    <input type="checkbox" name="paths" value="{{.ID}}"
                           id="path-{{.ID}}"
                           {{if $.Config}}{{if containsPath $.Config.Paths .ID}}checked{{end}}{{end}}>
                    <label for="path-{{.ID}}">
                        {{.Path}}
                        {{if .FromEnv}}<span class="locked">(from env)</span>{{end}}
                    </label>
                </div>
                {{end}}
                {{if not .Paths}}
                <p class="form-help">No paths configured. Add paths in <a href="/settings">Settings</a>.</p>
                {{end}}
            </div>

            <div class="grid-2">
                <div class="form-group">
                    <label class="form-label" for="min_size">Minimum File Size</label>
                    <input type="text" id="min_size" name="min_size" class="form-input"
                           value="{{if .Config}}{{.Config.MinSize | formatBytes}}{{else}}1 MB{{end}}"
                           placeholder="e.g., 1 MB, 100 KB">
                    <p class="form-help">Files smaller than this will be ignored</p>
                </div>

                <div class="form-group">
                    <label class="form-label" for="max_size">Maximum File Size (optional)</label>
                    <input type="text" id="max_size" name="max_size" class="form-input"
                           value="{{if .Config}}{{if .Config.MaxSize}}{{.Config.MaxSize | formatBytes}}{{end}}{{end}}"
                           placeholder="e.g., 10 GB">
                    <p class="form-help">Leave empty for no limit</p>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" for="include_patterns">Include Patterns (optional)</label>
                <input type="text" id="include_patterns" name="include_patterns" class="form-input"
                       value="{{if .Config}}{{.Config.IncludePatterns | joinPatterns}}{{end}}"
                       placeholder="e.g., *.mp4, *.mkv, *.avi">
                <p class="form-help">Comma-separated glob patterns. Leave empty to include all files.</p>
            </div>

            <div class="form-group">
                <label class="form-label" for="exclude_patterns">Exclude Patterns (optional)</label>
                <input type="text" id="exclude_patterns" name="exclude_patterns" class="form-input"
                       value="{{if .Config}}{{.Config.ExcludePatterns | joinPatterns}}{{end}}"
                       placeholder="e.g., *.nfo, *.txt, Thumbs.db">
                <p class="form-help">Comma-separated glob patterns to exclude</p>
            </div>

            <div class="actions-bar">
                <button type="submit" class="btn btn-primary">
                    {{if .Config}}Save Changes{{else}}Create Configuration{{end}}
                </button>
                <a href="/scans" class="btn">Cancel</a>
                {{if .Config}}
                <button type="button" class="btn btn-danger"
                        hx-delete="/scans/{{.Config.ID}}"
                        hx-confirm="Are you sure you want to delete this configuration?">
                    Delete
                </button>
                {{end}}
            </div>
        </form>
    </div>
</div>

{{if not .Config}}
<div class="card">
    <div class="card-header">Quick Scan</div>
    <div class="card-body">
        <p>Want to run a one-time scan without saving a configuration?</p>
        <form method="POST" action="/scans/quick">
            <div class="form-group">
                <label class="form-label">Select paths</label>
                {{range .Paths}}
                <div class="form-checkbox">
                    <input type="checkbox" name="paths" value="{{.ID}}" id="quick-path-{{.ID}}">
                    <label for="quick-path-{{.ID}}">
                        {{.Path}}
                        {{if .FromEnv}}<span class="locked">(from env)</span>{{end}}
                    </label>
                </div>
                {{end}}
            </div>
            <button type="submit" class="btn">Run Quick Scan</button>
        </form>
    </div>
</div>
{{end}}
{{end}}
